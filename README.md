# Global Infrastructure

Hey there. This repo houses the code that builds the Noxx Global Infrastructure.

The various [services that comprise the Noxx Platform](https://github.com/NoXX-Technologies/docs/blob/main/developers/services/README.md) hook into this infrastructure.

## Setup

[Make sure you have completed the onboarding necessary for your role(s)](https://github.com/beckett-media/docs/tree/main/onboarding)

You'll need command-line access to this repo and git clone it.

We suggest using `~/workspace/beckett` as the location in which to clone the project


### AWS Access

TODO: This is outdated


### Install CDK

`$ npm install -g aws-cdk`

### Install TypeScript

`$ npm install -g typescript`



### Install Project Dependencies

`$ yarn install # from project root`

## Deploying

`$ STAGE=<dev|preprod|production> cdk deploy --profile <profile> --all`

## Creating a new environment

Note - creating a new environment is not a necessary part of setup. If you are accessing and existing environment **DO NOT DO THIS**

### Create a new AWS Sub Account

TODO: this is outdated

### Get account number

`$ aws sts get-caller-identity --profile <profile>`

### Bootstrap an environment

`$ cdk bootstrap aws://<account-number>/us-east-1 --profile <profile>`

## Config File

Please read `[environment-config.ts](util/environment-config.ts)` to see what the various parameters do.

## Overview

- Diagram
  ![Diagram](Noxx%20Global%20Infrastructure%202.0.drawio.png)
- [Database Schema](https://dbdiagram.io/d/631f938d0911f91ba591ff92)
  ![Database Schema](Database%20Schema.png)

### Auto-generated ERD

To regenerate the ERD, run the following:

- `$ STAGE=<dev|preprod|production> cdk synth --profile <profile> --all`
- `$ npx cdk-dia`

![Autogenerated ERD](diagram.png)
